// Generated by CoffeeScript 1.3.3
/*
  backbone-articulation-backbone-relational.js 0.3.3
  (c) 2011, 2012 Kevin Malakoff.
  Backbone-Articulation-Backbone-Relational may be freely distributed under the MIT license.
  https://github.com/kmalakoff/backbone-articulation
*/(function(){var e,t,n,r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};if(typeof require!="undefined")try{n=require("lodash")}catch(s){n=require("underscore")}else n=this._;n&&n.hasOwnProperty("_")&&(n=n._),t=typeof require!="undefined"?require("backbone"):this.Backbone,e=typeof require!="undefined"?require("backbone-articulation"):this.Backbone.Articulation,typeof require!="undefined"&&require("backbone-relational"),typeof exports!="undefined"&&(module.exports=e),e.BackboneRelationalModel=t.RelationalModel.extend({toJSON:function(){var e,r,i,s,o,u,a,f,l,c;if(this.isLocked())return this.id;this.acquire(),r=this.__bba_toJSON?this.__bba_toJSON.call(this):function(){throw"Articulation.RelationalModel is not configured correctly"}(),c=this._relations;for(u=0,f=c.length;u<f;u++){s=c[u],o=r[s.key];if(s.options.includeInJSON===!0&&o&&typeof o=="object")r[s.key]=n.isFunction(o.toJSON)?o.toJSON():o;else if(n.isString(s.options.includeInJSON))if(!o)r[s.key]=null;else if(o instanceof t.Collection)r[s.key]=o.pluck(s.options.includeInJSON);else if(o instanceof t.Model)r[s.key]=o.get(s.options.includeInJSON);else if(n.isArray(o)){r[s.key]=[];for(e=a=0,l=o.length;a<l;e=++a)i=o[e],n.isUndefined(i)||r[s.key].push(i[s.options.includeInJSON])}else o instanceof Object&&(r[s.key]=o[s.options.includeInJSON]);else delete r[s.key]}return this.release(),r},_reset:function(){var e,t,n,r;if(this.models){r=this.models;for(t=0,n=r.length;t<n;t++)e=r[t],Relational.Relational.store.unregister(e)}return this.constructor.__super__.constructor.__super__._reset.apply(this,arguments)}}),e.Model.mixin(e.BackboneRelationalModel),e.BackboneRelationalCollection=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.model=e.BackboneRelationalModel,n}(e.Collection)}).call(this);